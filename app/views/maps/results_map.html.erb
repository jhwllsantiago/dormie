<div id="results-map" style="width: 75vw; height: 80vh; margin: 10px auto;"></div>
<script>
  function initializeResultsMap() {
    const center = { "lat": <%= @center[0].to_f %>, "lng": <%= @center[1].to_f %> };
    const target = document.getElementById("results-map");
    const map = new google.maps.Map(target, {
      zoom: 10,
      center,
    });
      
    const rooms = <%= @rooms.to_json.html_safe %>
    var infowindow =  new google.maps.InfoWindow({
      disableAutoPan: true
    });
    var marker, count;
    for (count = 0; count < rooms.length; count++) {
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(rooms[count]["latitude"], rooms[count]["longitude"]),
        map,
      }); 
      google.maps.event.addListener(marker, "mouseover", ((marker, count) => {
        return () => {
          infowindow.setContent(`
          <div class="infowindow">
            <p class="infowindow-item">${rooms[count]['location_name']}</p>
            <p class="infowindow-item">${rooms[count]['name']}</p>
            <p class="infowindow-item">â‚±${rooms[count]['rent']}</p>
            <p class="infowindow-item"><a href="/rooms/${rooms[count]['id']}" target="_blank">Details</a></p>
          </div>
          `);
          infowindow.open(map, marker);
        }
      })(marker, count));
    }
  }
</script>
<%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key=#{ENV["GM_KEY"]}&callback=initializeResultsMap&v=weekly",
  async: true,
  defer: true
%>